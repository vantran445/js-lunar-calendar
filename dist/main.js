(()=>{"use strict";(()=>{function e(e){return Math.floor(e)}function t(t,s,r,n=0,a=0,i=0){let h,o,u,l;return h=e((14-s)/12),o=r+4800-h,u=s+12*h-3,l=t+e((153*u+2)/5)+365*o+e(o/4)-e(o/100)+e(o/400)-32045,l<2299161&&(l=t+e((153*u+2)/5)+365*o+e(o/4)-32083),l+=(n+a/60+i/3600)/24,l}function s(t,s=0){let r,n,a,i,h,o,u;return r=(t-2451545.5-s/24)/36525,n=Math.PI/180,a=280.46+36000.77*r,i=357.528+35999.05*r,h=1.915*Math.sin(n*i)+.02*Math.sin(2*n*i),o=a+h,u=o-360*e(o/360),u}const r=class{constructor(e,t,s,r=0,n=0,a=0,i=7){this.input={d:e,m:t,Y:s,H:r,i:n,s:a,timezone:i},this.output=this.#getOutput()}#getJdNewMoon(e){let t,s,r,n,a,i,h,o,u,l,c;return t=e/1236.85,s=t*t,r=s*t,n=Math.PI/180,a=2415020.75933+29.53058868*e+1178e-7*s-155e-9*r,a+=33e-5*Math.sin((166.56+132.87*t-.009173*s)*n),i=359.2242+29.10535608*e-333e-7*s-347e-8*r,h=306.0253+385.81691806*e+.0107306*s+1236e-8*r,o=21.2964+390.67050646*e-.0016528*s-239e-8*r,u=(.1734-393e-6*t)*Math.sin(i*n)+.0021*Math.sin(2*n*i),u=u-.4068*Math.sin(h*n)+.0161*Math.sin(2*n*h),u-=4e-4*Math.sin(3*n*h),u=u+.0104*Math.sin(2*n*o)-.0051*Math.sin(n*(i+h)),u=u-.0074*Math.sin(n*(i-h))+4e-4*Math.sin(n*(2*o+i)),u=u-4e-4*Math.sin(n*(2*o-i))-6e-4*Math.sin(n*(2*o+h)),u=u+.001*Math.sin(n*(2*o-h))+5e-4*Math.sin(n*(2*h+i)),l=t<-11?.001+839e-6*t+2261e-7*s-845e-8*r-81e-9*t*r:265e-6*t-278e-6+262e-6*s,c=a+u-l,c}#getJdLunarNovemberNewMoon(r){let n,a,i,h,o;return n=t(31,12,r),a=n-2415021,i=e(a/29.530588853),h=this.#getJdNewMoon(i),o=e(s(h,this.timezone)/30),o>=9?this.#getJdNewMoon(i-1):h}#getLeapMonthOffset(t){let r,n,a,i;r=e((t-2415021.076998695)/29.530588853+.5),n=0,a=1,i=e(s(this.getJdNewMoon(r+a),this.timezone)/30);do{++a,n=i,i=e(s(this.getJdNewMoon(r+a),this.timezone)/30)}while(i!=n&&a<14)}#getJdNewDay(){let e=t(this.input.d,this.input.m,this.input.Y);return 23===this.input.H&&++e,e}#getOutput(){let t,s,r,n,a,i,h,o,u,l,c;return t=this.#getJdNewDay(),s=e((t-2415021.076998695)/29.530588853),r=this.#getJdNewMoon(s+1),r>t&&(r=this.#getJdNewMoon(s)),n=this.#getJdLunarNovemberNewMoon(this.input.Y),a=n,n>=r?(i=this.input.Y,n=this.#getJdLunarNovemberNewMoon(this.input.Y-1)):(i=this.input.Y+1,a=this.#getJdLunarNovemberNewMoon(this.input.Y+1)),h=t-r+1,o=e((r-n)/29),u=0,l=o+11,a-n>365&&(c=this.#getLeapMonthOffset(n),o>=c&&(l=o+10,o==c&&(u=1))),l>12&&(l-=12),l>=11&&o<4&&(i-=1),{d:e(h),m:l,Y:i,l:u,j:t}}get(e){switch(e){case"d":case"D":return this.output.d;case"m":case"M":return this.output.m;case"y":case"Y":return this.output.Y;case"l":return this.output.l;case"j":case"J":return this.output.j;case"h":case"H":return this.input.H;case"i":case"I":return this.input.i;case"s":case"S":return this.input.s;case"z":case"Z":return this.input.timezone;default:throw"Invalid key."}}format(e){let t=["d","D","m","M","y","Y","j","J","h","H","i","I","s","S","z","Z","l"];for(const s of t)if(e.includes(s)){let t=this.get(s);"d"!=s&&"D"!=s&&"m"!=s&&"M"!=s||t<10&&(t="0"+t);do{e=e.replace(s,t)}while(e.includes(s))}return e}},n=JSON.parse('{"ty":"Tý","suu":"Sửu","dan":"Dần","mao":"Mão","thin":"Thìn","ti":"Tị","ngo":"Ngọ","mui":"Mùi","than":"Thân","dau":"Dậu","tuat":"Tuất","hoi":"Hợi","giap":"Giáp","at":"Ất","binh":"Bính","dinh":"Đinh","mau":"Mậu","ky":"Kỷ","canh":"Canh","tan":"Tân","nham":"Nhâm","quy":"Quý","{day}":"ngày","{month}":"tháng","{year}":"năm"}'),a=class{term_keys=["key_1","key_2","key_3"];term_labels=["Label 1","Lable 2","Label 3"];constructor(e){this.offset=e}getOffset(){return this.offset}getKey(){return null!=this.term_keys[this.offset]?this.term_keys[this.offset]:"_key_"+this.offset}getLabel(){return(new class{trans(e){return null!=n[e]?n[e]:e}setLocalization(e){let t=JSON.parse(e);for(const[e,s]of Object.entries(t))n["${key}"]="${val}"}}).trans(this.getKey())}},i=class extends a{term_keys=["giap","at","binh","dinh","mau","ky","canh","tan","nham","quy"];constructor(e){try{if(e<0||e>9)throw"The offset of Heavenly stem should be 0 through 9.";super(e)}catch(e){console.error(e)}}},h=class extends a{term_keys=["ty","suu","dan","mao","thin","ti","ngo","mui","than","dau","tuat","hoi"];constructor(e){try{if(e<0||e>11)throw"The offset of Earthly branch should be 0 through 11.";super(e)}catch(e){console.error(e)}}};var o=new r(17,9,2021,0,0,0,7);console.log(o.format("d/m/Y H:i:s j z l"));let u=new class extends r{constructor(e,t,s,r=0,n=0,a=0,i=7){super(e,t,s,r,n,a,i),this.termOffsets={},this.allowKeys=["d","D","m","M","y","Y","h","H","N"]}#getHoursEarthlyBranchOffset(){let e=23,t=0;for(;e!=super.get("H");)e=(e+1)%24,e%2!=0&&(t=(t+1)%12);return t}#getBeginDayHoursHeacenlyStemOffset(){let e=0,t=0,s=this.#getOffset("D");for(;t!=s;)t=(t+1)%10,e=(e+2)%10;return e}#getCurrentHoursHeavenlyStemOffset(){let e=this.#getOffset("N"),t=23;for(;t!=super.get("H");)t=(t+1)%24,t%2!=0&&(e=(e+1)%10);return e}#getOffset(e){if(null!=this.termOffsets[e])return this.termOffsets[e];let t;switch(e){case"d":t=(super.get("j")+1)%12;break;case"D":t=(super.get("j")+9)%10;break;case"m":t=(super.get("m")+1)%12;break;case"M":t=(12*super.get("Y")+super.get("m")+3)%10;break;case"y":t=(super.get("Y")+8)%12;break;case"Y":t=(super.get("Y")+6)%10;break;case"h":t=this.#getHoursEarthlyBranchOffset();break;case"N":t=this.#getBeginDayHoursHeacenlyStemOffset();break;case"H":t=this.#getCurrentHoursHeavenlyStemOffset();break;default:let e="";throw this.allowKeys.forEach((t=>{e+=t+", "})),e=e.slice(0,-2),"Invalid Sexagenary term key. There keys are allow: "+e}return this.termOffsets[e]=t,t}getTerm(e){let t;try{return t=this.#getOffset(e),e==e.toUpperCase()?new i(t):new h(t)}catch(e){console.error(e)}}format(e,t=2){if(1==t)return super.format(e);let s=[...e.matchAll(/\{(.*?)\}/g)],r=e;null!=s[0]&&s.forEach(((e,t)=>{r=r.replace(e[0],"{_"+t+"_}")}));let n=[],a=0;return this.allowKeys.forEach((e=>{if(r.includes(e))do{n[a]=e,r=r.replace(e,"[_"+a+"_]"),++a}while(r.includes(e))})),n.length>0&&n.forEach(((e,t)=>{let s=this.getTerm(e);r=r.replace("[_"+t+"_]",s.getLabel())})),null!=s[0]&&s.forEach(((e,t)=>{r=r.replace("{_"+t+"_}",e[1])})),r}}(18,9,2021,10,0,0,7);throw console.log(u.format("d/m/Y",1)),console.log(u.format("{Ngay} D d, {thang} M m, {nam} Y y, {gio} H h")),"Error"})()})();